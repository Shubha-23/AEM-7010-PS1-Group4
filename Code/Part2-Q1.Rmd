---
title: "Part2-Q1"
author: "Tianjiao Mei" "Yongfan Zhao"
date: "2023-10-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load library

```{r}
library(tidyverse)
library(data.table)
library(purrr)

library(knitr)
library(kableExtra)
```

## Data Preparation

```{r}
in_path <- dirname(getwd())
ck1994_raw_data <- read.table(file.path(in_path, 'Data', 'Raw', 'ck1994_data.dat'))

name_changes <- c('SHEET', 'CHAIN', 'CO_OWNED', 'STATE', 'SOUTHJ', 'CENTRALJ',
             'NORTHJ', 'PA1', 'PA2', 'SHORE', 'NCALLS', 'EMPFT', 'EMPPT',
             'NMGRS', 'WAGE_ST', 'INCTIME', 'FIRSTINC', 'BONUS', 'PCTAFF',
             'MEALS', 'OPEN', 'HRSOPEN', 'PSODA', 'PFRY', 'PENTREE', 'NREGS',
             'NREGS11', 'TYPE2', 'STATUS2', 'DATE2', 'NCALLS2', 'EMPFT2',
             'EMPPT2', 'NMGRS2', 'WAGE_ST2', 'INCTIME2', 'FIRSTIN2', 'SPECIAL2',
             'MEALS2', 'OPEN2R', 'HRSOPEN2', 'PSODA2', 'PFRY2', 'PENTREE2', 
             'NREGS2','NREGS112')

ck1994_raw_data_col <- ck1994_raw_data %>%
  set_names(name_changes)
```

## Table 2 - 1

```{r}
## count total stores by state
store_count_state <- ck1994_raw_data_col %>%
  select(CHAIN, CO_OWNED, STATE) %>%
  group_by(STATE) %>%
  summarise(total_store_count = n())

## distribution by chain
store_distribution_chain <- ck1994_raw_data_col %>%
  select(CHAIN, STATE) %>%
  group_by(CHAIN, STATE) %>%
  summarise(store_count = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(distribution_chain = round((store_count/total_store_count)*100, 1)) %>%
  
  select(CHAIN, STATE, distribution_chain) %>%
  pivot_wider(names_from = STATE, values_from = distribution_chain) %>%
  
  mutate(CHAIN = recode(CHAIN, 
                        "1" = "Burger King", 
                        "2" = "KFC", 
                        "3" = "Roy Rogers",
                        "4" = "Wendy's")) %>%
  rename(Type = CHAIN)

## distribution by co-owned
store_distribution_own <- ck1994_raw_data_col %>%
  select(CO_OWNED, STATE) %>%
  group_by(CO_OWNED, STATE) %>%
  summarise(store_count = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(distribution_own = round((store_count/total_store_count)*100, 1)) %>%
  filter(CO_OWNED == 1) %>%
  
  select(CO_OWNED, STATE, distribution_own) %>%
  pivot_wider(names_from = STATE, values_from = distribution_own) %>%
  
  mutate(CO_OWNED= recode(CO_OWNED, 
                        "1" = "Company_owned")) %>%
  rename(Type = CO_OWNED)

## Combine together

store_distribution_types <- store_distribution_chain %>%
  full_join(store_distribution_own) %>%
  rename(NJ = "1", PA = "0") %>%
  select(Type, NJ, PA) %>%
  rename (Variable = Type)
store_distribution_types
```

## Table 2 - 2

```{r}
## create variables (FTE, PFE, PFULL)

ck1994_new <- ck1994_raw_data_col %>%
  mutate(EMPFT = as.numeric(EMPFT),
         NMGRS = as.numeric(NMGRS),
         EMPPT = as.numeric(EMPPT),
         EMPFT2 = as.numeric(EMPFT2),
         NMGRS2 = as.numeric(NMGRS2),
         EMPPT2 = as.numeric(EMPPT2),
         
         WAGE_ST = as.numeric(WAGE_ST),
         WAGE_ST2 = as.numeric(WAGE_ST2),
         
         PSODA = as.numeric(PSODA),
         PSODA2 = as.numeric(PSODA2),
         PFRY = as.numeric(PFRY),
         PFRY2 = as.numeric(PFRY2),
         PENTREE = as.numeric(PENTREE),
         PENTREE2 = as.numeric(PENTREE2),
         
         HRSOPEN2 = as.numeric(HRSOPEN2)) %>%
  
  mutate(FTE = EMPFT + NMGRS + (0.5)*EMPPT,
         FTE2 = EMPFT2 + NMGRS2 + (0.5)*EMPPT2) %>%
  
  mutate(Fulltime_Perc = (EMPFT/FTE)*100,
         Fulltime_Perc2 = (EMPFT2/FTE2)*100) %>%
  
mutate(PFULL = PSODA + PFRY + PENTREE,
       PFULL2 = PSODA2 + PFRY2 + PENTREE2)   
  
```

```{r}
# Calculate means:

## 1. calculate mean of 4.25 wage percentage

ck1994_4.25_wave1 <- ck1994_raw_data_col %>%
  select(STATE, WAGE_ST) %>%
  filter(WAGE_ST == 4.25) %>%
  group_by(STATE) %>%
  summarise(count_4.25 = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(wage_4.25_perc = round((count_4.25/total_store_count)*100, 1)) %>%
  
  select(STATE, wage_4.25_perc)

## 2. calculate mean of bonus

ck1994_bonus_wave1 <- ck1994_raw_data_col %>%
  select(STATE, BONUS) %>%
  filter(BONUS == 1) %>%
  group_by(STATE) %>%
  summarise(count_bonus = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(bonus_perc = round((count_bonus/total_store_count)*100, 1)) %>%
  
  select(STATE, bonus_perc)

## calculate other means and se and combine together:

stat_wave1 <- ck1994_new %>%
  select(STATE, FTE, Fulltime_Perc, WAGE_ST, HRSOPEN, PFULL)%>%
  group_by(STATE) %>%
  summarise(mean_FTE = mean(FTE, na.rm = T),
            sem_FTE = sd(FTE, na.rm = T) / sqrt(n()),
            mean_fulltime_perc = mean(Fulltime_Perc, na.rm = T),
            sem_fulltime_perc = sd(Fulltime_Perc, na.rm = T) / sqrt(n()),
            mean_wage_st = mean(WAGE_ST, na.rm = T),
            sem_wage_st = sd(WAGE_ST, na.rm = T) / sqrt(n()),
            mean_pfull = mean(PFULL, na.rm = T),
            sem_pfull = sd(PFULL, na.rm = T) / sqrt(n()),
            mean_hours_open = mean(HRSOPEN, na.rm = T),
            sem_hours_open = sd(HRSOPEN, na.rm = T) / sqrt(n())) %>%
  
  left_join(ck1994_4.25_wave1, by = "STATE") %>%
  left_join(ck1994_bonus_wave1, by = "STATE")
```

```{r}
# Calculate t stats:

t.stat.FTE <- -(t.test(FTE ~ STATE, data = ck1994_new)$statistic) # negative sign because of different definition of group 0 and group 1
t.stat.PFE <- -(t.test(Fulltime_Perc ~ STATE, data = ck1994_new)$statistic) 
t.stat.WAGE.ST <- -(t.test(WAGE_ST ~ STATE, data = ck1994_new)$statistic) 
t.stat.PFULL <- -(t.test(PFULL ~ STATE, data = ck1994_new)$statistic) 
t.stat.HRSOPEN <- -(t.test(HRSOPEN ~ STATE, data = ck1994_new)$statistic) 

t.stat <- data_frame(t.stat.FTE, t.stat.PFE, t.stat.WAGE.ST, t.stat.PFULL, t.stat.HRSOPEN) 
```

```{r}
# Combine means, se, and t-stats for Table 2-2:

## 1. mean and se:

mean_se_wave1 <- 
  stat_wave1 %>%
  mutate(
    mean_se_FTE = sprintf("%.1f (%.2f)", mean_FTE, sem_FTE),
    mean_se_PFE = sprintf("%.1f (%.1f)", mean_fulltime_perc, sem_fulltime_perc),
    mean_se_wage_st = sprintf("%.2f (%.2f)", mean_wage_st, sem_wage_st),
    mean_se_pfull = sprintf("%.2f (%.2f)", mean_pfull, sem_pfull),
    mean_se_hoursopen = sprintf("%.1f (%.1f)", mean_hours_open, sem_hours_open),
    mean_4.25_perc = wage_4.25_perc,
    mean_bonus = bonus_perc
  ) %>%
  select(mean_se_FTE, mean_se_PFE, mean_se_wage_st, mean_4.25_perc, 
         mean_se_pfull, mean_se_hoursopen, mean_bonus) %>%
  rename("FTE Employment" = mean_se_FTE,
         "Percentage full-time employees" = mean_se_PFE,
         "Starting wage" = mean_se_wage_st,
         "Wage = $4.25 (percentage)" = mean_4.25_perc,
         "Price of full meal" = mean_se_pfull,
         "Hours opwn(weekday)" = mean_se_hoursopen,
         "Recruiting bonus" = mean_bonus)

transpose_mean_se_wave1 <- as.data.frame(t(mean_se_wave1))
row.names(transpose_mean_se_wave1) <- NULL

transpose_mean_se_wave1 <- transpose_mean_se_wave1 %>%
  mutate(Variable = colnames(mean_se_wave1)) %>%
  rename(PA = V1,
         NJ = V2) %>%
  select(Variable, NJ, PA)


## t stat:

data.t.stat <- t.stat %>%
   rename("FTE Employment" = t.stat.FTE,
         "Percentage full-time employees" = t.stat.PFE,
         "Starting wage" = t.stat.WAGE.ST,
         "Price of full meal" = t.stat.PFULL,
         "Hours opwn(weekday)" = t.stat.HRSOPEN) %>%
  mutate(
    "Wage = $4.25 (percentage)"= NA,
    "Recruiting bonus" = NA
  )


transpose_t.stat.data <- as.data.frame(t(data.t.stat))
row.names(transpose_t.stat.data) <- NULL

transpose_t.stat <- transpose_t.stat.data %>%
  mutate(Variable = colnames(data.t.stat)) %>%
  rename(t_stat = V1) %>%
  select(Variable, t_stat) %>%
  mutate(t_stat = round(t_stat, 1))

## 3. combine mean, se, and t-stat

wave_1_data <- transpose_mean_se_wave1 %>%
  left_join(transpose_t.stat, by = "Variable")

wave_1_data
```

## Table 2 - 3

```{r}
# Calculate means:

## 1.1 calculate mean of 4.25 wage percentage

ck1994_4.25_wave2 <- ck1994_raw_data_col %>%
  select(STATE, WAGE_ST2) %>%
  filter(WAGE_ST2 == 4.25) %>%
  group_by(STATE) %>%
  summarise(count_4.25 = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(wage_4.25_perc2 = round((count_4.25/total_store_count)*100, 1)) %>%
  
  select(STATE, wage_4.25_perc2)

## 1.2 calculate mean of 5.05 wage percentage

ck1994_5.05_wave2 <- ck1994_raw_data_col %>%
  select(STATE, WAGE_ST2) %>%
  mutate(WAGE_ST2 = na_if(WAGE_ST2, ".")) %>%
  filter(WAGE_ST2 == 5.05) %>%
  group_by(STATE) %>%
  summarise(count_5.05 = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(wage_5.05_perc2 = round((count_5.05/total_store_count)*100, 1)) %>%
  
  select(STATE, wage_5.05_perc2)

## 2. calculate mean of bonus

ck1994_bonus_wave2 <- ck1994_raw_data_col %>%
  select(STATE, SPECIAL2) %>%
  filter(SPECIAL2  == 1) %>%
  group_by(STATE) %>%
  summarise(count_bonus = n()) %>%
  
  left_join(store_count_state, by = "STATE") %>%
  mutate(bonus_perc2 = round((count_bonus/total_store_count)*100, 1)) %>%
  
  select(STATE, bonus_perc2)

## calculate other means and se and combine together:

stat_wave2 <- ck1994_new %>%
  select(STATE, FTE2, Fulltime_Perc2, WAGE_ST2, HRSOPEN2, PFULL2)%>%
  group_by(STATE) %>%
  summarise(mean_FTE2 = mean(FTE2, na.rm = T),
            sem_FTE2 = sd(FTE2, na.rm = T) / sqrt(n()),
            mean_fulltime_perc2 = mean(Fulltime_Perc2, na.rm = T),
            sem_fulltime_perc2 = sd(Fulltime_Perc2, na.rm = T) / sqrt(n()),
            mean_wage_st2 = mean(WAGE_ST2, na.rm = T),
            sem_wage_st2 = sd(WAGE_ST2, na.rm = T) / sqrt(n()),
            mean_pfull2 = mean(PFULL2, na.rm = T),
            sem_pfull2 = sd(PFULL2, na.rm = T) / sqrt(n()),
            mean_hours_open2 = mean(HRSOPEN2, na.rm = T),
            sem_hours_open2 = sd(HRSOPEN2, na.rm = T) / sqrt(n())) %>%
  
  left_join(ck1994_4.25_wave2, by = "STATE") %>%
  left_join(ck1994_5.05_wave2, by = "STATE") %>%
  left_join(ck1994_bonus_wave2, by = "STATE") %>%
  replace_na(list(wage_4.25_perc2 = 0.0))

```

```{r}
# Calculate t stats:

t.stat.FTE2 <- -(t.test(FTE2 ~ STATE, data = ck1994_new)$statistic) # negative sign because of different definition of group 0 and group 1
t.stat.PFE2 <- -(t.test(Fulltime_Perc2 ~ STATE, data = ck1994_new)$statistic) 
t.stat.WAGE.ST2 <- -(t.test(WAGE_ST2 ~ STATE, data = ck1994_new)$statistic) 
t.stat.PFULL2 <- -(t.test(PFULL2 ~ STATE, data = ck1994_new)$statistic) 
t.stat.HRSOPEN2 <- -(t.test(HRSOPEN2 ~ STATE, data = ck1994_new)$statistic) 

t.stat2 <- data_frame(t.stat.FTE2, t.stat.PFE2, t.stat.WAGE.ST2, t.stat.PFULL2, t.stat.HRSOPEN2) 
```

```{r}
# Combine means, se, and t-stats for Table 2-3:

## 1. mean and se:

mean_se_wave2 <- 
  stat_wave2 %>%
  mutate(
    mean_se_FTE2 = sprintf("%.1f (%.2f)", mean_FTE2, sem_FTE2),
    mean_se_PFE2 = sprintf("%.1f (%.1f)", mean_fulltime_perc2, sem_fulltime_perc2),
    mean_se_wage_st2 = sprintf("%.2f (%.2f)", mean_wage_st2, sem_wage_st2),
    mean_se_pfull2 = sprintf("%.2f (%.2f)", mean_pfull2, sem_pfull2),
    mean_se_hoursopen2 = sprintf("%.1f (%.1f)", mean_hours_open2, sem_hours_open2),
    mean_4.25_perc2 = wage_4.25_perc2,
    mean_5.05_perc2 = wage_5.05_perc2,
    mean_bonus2 = bonus_perc2
  ) %>%
  select(mean_se_FTE2, mean_se_PFE2, mean_se_wage_st2, mean_4.25_perc2, mean_5.05_perc2,
         mean_se_pfull2, mean_se_hoursopen2, mean_bonus2) %>%
  rename("FTE Employment" = mean_se_FTE2,
         "Percentage full-time employees" = mean_se_PFE2,
         "Starting wage" = mean_se_wage_st2,
         "Wage = $4.25 (percentage)" = mean_4.25_perc2,
         "Wage = $5.05 (percentage)" = mean_5.05_perc2,
         "Price of full meal" = mean_se_pfull2,
         "Hours opwn(weekday)" = mean_se_hoursopen2,
         "Recruiting bonus" = mean_bonus2)

transpose_mean_se_wave2 <- as.data.frame(t(mean_se_wave2))
row.names(transpose_mean_se_wave2) <- NULL

transpose_mean_se_wave2 <- transpose_mean_se_wave2 %>%
  mutate(Variable = colnames(mean_se_wave2)) %>%
  rename(PA = V1,
         NJ = V2) %>%
  select(Variable, NJ, PA)


## t stat:

data.t.stat2 <- t.stat2 %>%
   rename("FTE Employment" = t.stat.FTE2,
         "Percentage full-time employees" = t.stat.PFE2,
         "Starting wage" = t.stat.WAGE.ST2,
         "Price of full meal" = t.stat.PFULL2,
         "Hours opwn(weekday)" = t.stat.HRSOPEN2) %>%
  mutate(
    "Wage = $4.25 (percentage)"= NA,
    "Wage = $5.05 (percentage)"= NA,
    "Recruiting bonus" = NA
  )


transpose_t.stat.data2 <- as.data.frame(t(data.t.stat2))
row.names(transpose_t.stat.data2) <- NULL

transpose_t.stat2 <- transpose_t.stat.data2 %>%
  mutate(Variable = colnames(data.t.stat2)) %>%
  rename(t_stat = V1) %>%
  select(Variable, t_stat) %>%
  mutate(t_stat = round(t_stat, 1))

## 3. combine mean, se, and t-stat

wave_2_data <- transpose_mean_se_wave2 %>%
  left_join(transpose_t.stat2, by = "Variable")
wave_2_data
```

```{r}
# Table 3: Column 1-3

# 1st row
  T3R1 <- ck1994_new %>% 
          select(STATE, FTE) %>%
          group_by(STATE) %>% # group_by state
          summarise(mean = mean(FTE, na.rm = TRUE), 
                    var= var(FTE, na.rm = TRUE), 
                    nasum = sum(is.na(FTE)), 
                    N=n()) %>% # aggregate/summarize data
          mutate(n = N - nasum) %>% 
          mutate(se = sqrt(var/n))

# calculate differences
  T3R1_res <- bind_rows(T3R1, T3R1[2,]-T3R1[1,])
  T3R1_res$group<- c("PA", "NJ", "Difference")
  T3R1_res$wave = 1
  T3R1_res <- T3R1_res[,-1]
  
  # Calculate SE for difference: SE = SQR(VAR/N + VAR/N)
  diff_se1 <- sqrt(T3R1_res$var[1]/T3R1_res$n[1] + T3R1_res$var[2]/T3R1_res$n[2])
  diff_se1
  # Edit original cell
  T3R1_res$se[3] <- diff_se1
  
  # organize them together
  T3R1_res <- T3R1_res %>% mutate_if(is.numeric, ~ round(.,2))
  T3R1_res

  T3R1_m <- data.frame(PA=c(paste(T3R1_res$mean[1],"(",T3R1_res$se[1],")")),
                     NJ=c(paste(T3R1_res$mean[2],"(",T3R1_res$se[2],")")),
                     DIFF_NJPA=c(paste(T3R1_res$mean[3],"(",T3R1_res$se[3],")")))
  T3R1_m
```

```{r}
# 2ed row
  T3R2 <- ck1994_new %>% 
          select(STATE, FTE2) %>%
          group_by(STATE) %>% # group_by state
          summarise(mean = mean(FTE2, na.rm = TRUE), 
                    var= var(FTE2, na.rm = TRUE), 
                    nasum = sum(is.na(FTE2)), 
                    N=n()) %>% # aggregate/summarize data
          mutate(n = N - nasum) %>% 
          mutate(se = sqrt(var/n))

# calculate differences
  T3R2_res <- bind_rows(T3R2, T3R2[2,]-T3R2[1,])
  T3R2_res$group<- c("PA", "NJ", "Difference")
  T3R2_res$wave = 2
  T3R2_res <- T3R2_res[,-1]
# Calculate SE for difference: SE = SQR(VAR/N + VAR/N)
  diff_se2 <- sqrt(T3R2_res$var[1]/T3R2_res$n[1] + T3R2_res$var[2]/T3R2_res$n[2])
  diff_se2
# Edit original cell
  T3R2_res$se[3] <- diff_se2
  
  kable(T3R2_res, digits=2)

  # organize them together
  T3R2_res <- T3R2_res %>% mutate_if(is.numeric, ~ round(.,2))
  T3R2_res

  T3R2_m <- data.frame(PA=c(paste(T3R2_res$mean[1],"(",T3R2_res$se[1],")")),
                     NJ=c(paste(T3R2_res$mean[2],"(",T3R2_res$se[2],")")),
                     DIFF_NJPA=c(paste(T3R2_res$mean[3],"(",T3R2_res$se[3],")")))
  T3R2_m
```

```{r}
# 3rd Row
T3R3 <- rbind(T3R1_res, T3R2_res)
T3R3
# SE = SQR(VAR/N + VAR/N)
change_mean_PA <- round(T3R3$mean[4] - T3R3$mean[1], 2)
change_mean_PA_se <- round(sqrt(T3R3$var[4]/T3R3$n[4] + T3R3$var[1]/T3R3$n[1]), 2)

change_mean_NJ <- round(T3R3$mean[5] - T3R3$mean[2], 2)
change_mean_NJ_se <- round(sqrt(T3R3$var[5]/T3R3$n[5] + T3R3$var[2]/T3R3$n[2]),2)

DD <- round(change_mean_NJ - change_mean_PA, 2)
DD_se <- round(sqrt(T3R3$se[3] + T3R3$se[6]), 2)

# organize them together
T3R3_m <- data.frame(PA=c(paste(change_mean_PA,"(",change_mean_PA_se,")")),
                     NJ=c(paste(change_mean_NJ,"(",change_mean_NJ_se,")")),
                     DIFF_NJPA=c(paste(DD,"(",DD_se,")")))
T3R3_m
```

```{r}
# 4th row
ck1994_new$FTE_change <- ck1994_new$FTE2 - ck1994_new$FTE


  T3R4 <- ck1994_new %>% 
          select(STATE, FTE_change) %>%
          group_by(STATE) %>% # group_by state
          summarise(mean = mean(FTE_change, na.rm = TRUE), 
                    var= var(FTE_change, na.rm = TRUE), 
                    nasum = sum(is.na(FTE_change)), 
                    N=n()) %>% # aggregate/summarize data
          mutate(n = N - nasum) %>% 
          mutate(se = sqrt(var/n))

# calculate differences
  T3R4_res <- bind_rows(T3R4, T3R4[2,]-T3R4[1,])
  T3R4_res$group<- c("PA", "NJ", "Difference")
  T3R4_res <- T3R4_res[,-1]
# Calculate SE for difference: SE = SQR(VAR/N + VAR/N)
  diff_se3 <- sqrt(T3R4_res$var[1]/T3R4_res$n[1] + T3R4_res$var[2]/T3R4_res$n[2])
  diff_se3
# Edit original cell
  T3R4_res$se[3] <- diff_se3
  
  kable(T3R4_res, digits=2)
  
  T3R4_res <- T3R4_res %>% mutate_if(is.numeric, ~ round(.,2))
  
# organize them together
T3R4_m <- data.frame(PA=c(paste(T3R4_res$mean[1],"(",T3R4_res$se[1],")")),
                     NJ=c(paste(T3R4_res$mean[2],"(",T3R4_res$se[2],")")),
                     DIFF_NJPA=c(paste(T3R4_res$mean[3],"(",T3R4_res$se[3],")")))
T3R4_m
```

```{r}
# 5th Row
# setting FTE at temporarily closed stores to O
ck1994_new$FTE2_5 <- ifelse(ck1994_new$STATUS2>=2, 0, ck1994_new$FTE2)
ck1994_new$FTE_change5 <- ck1994_new$FTE2_5 - ck1994_new$FTE


  T3R5 <- ck1994_new %>% 
          select(STATE, FTE_change5) %>%
          group_by(STATE) %>% # group_by state
          summarise(mean = mean(FTE_change5, na.rm = TRUE), 
                    var= var(FTE_change5, na.rm = TRUE), 
                    nasum = sum(is.na(FTE_change5)), 
                    N=n()) %>% # aggregate/summarize data
          mutate(n = N - nasum) %>% 
          mutate(se = sqrt(var/n))

# calculate differences
  T3R5_res <- bind_rows(T3R5, T3R5[2,]-T3R5[1,])
  T3R5_res$group<- c("PA", "NJ", "Difference")
  T3R5_res <- T3R5_res[,-1]
# Calculate SE for difference: SE = SQR(VAR/N + VAR/N)
  diff_se3 <- sqrt(T3R5_res$var[1]/T3R5_res$n[1] + T3R5_res$var[2]/T3R5_res$n[2])
  diff_se3
# Edit original cell
  T3R5_res$se[3] <- diff_se3
  
  kable(T3R5_res, digits=2)

T3R5_res <- T3R5_res %>% mutate_if(is.numeric, ~ round(.,2))
T3R5_res
  
# organize them together
T3R5_m <- data.frame(PA=c(paste(T3R5_res$mean[1],"(",T3R5_res$se[1],")")),
                     NJ=c(paste(T3R5_res$mean[2],"(",T3R5_res$se[2],")")),
                     DIFF_NJPA=c(paste(T3R5_res$mean[3],"(",T3R5_res$se[3],")")))
T3R5_m
```

```{r}
# append all dfs together
T3 <- rbind(T3R1_m,T3R2_m,T3R3_m,T3R4_m,T3R5_m) 

# add row names
rownames(T3) <- c("FTE employment before, all available observations",
                  "FTE employment after, all available observations",
                  "Change in mean FTE employment",
                  "Change in mean FTE employment, balanced sample fo stores",
                  "Change in mean FTE employment, setting FTE at temporarily closed stores to 0")
colnames(T3) <- c("PA","NJ","Difference, NJ-PA")
T3

```

```{r}
# NW 2000 Table 4
# construct nonmanagement employment
ck1994_new$FTE_nm <- EMPFT + (0.5)*EMPPT
ck1994_new$FTE2_nm <- EMPFT2 + (0.5)*EMPPT2

# create regression sample
# drop missing for starting wage and managers
data_r1 <- ck1994_new

```

```{r}
read.table(file.path(in_path, 'Data', 'Raw', 'nw2000_data.dat'))
name_changes <- c('nmempa', 'hoursa', 'nmempb', 'hoursb', 'nmempc', 'hoursc',
             'nmempd', 'hoursd', 'nmemp2a', 'hours2a', 'nmemp2b', 'hours2b', 'nmemp2c',
             'hours2c', 'nmemp2d', 'hours2d', 'zip13', 'chain', 'PA',
             'NJ', 'fullzip', 'biwkly', 'mnthly', 'comp')

nw2000_raw_data_col <- nw2000_raw_data %>%
  select(-V25, - V26, - V27) %>%
  set_names(name_changes) %>%
  mutate(across(where(is.character), as.numeric))
```

```{r}
## if randomly extract "nmempa/b/c/d as the FTE:
nw2000_random <- nw2000_raw_data_col %>%
  rowwise() %>%
  mutate(FTE = {
    vals <- c(nmempa, nmempb, nmempc, nmempd)
    valid_vals <- vals[!is.na(vals)]
    if(length(valid_vals) == 0) NA else sample(valid_vals, 1)},
    
    FTE2 = {
    vals <- c(nmemp2a, nmemp2b, nmemp2c, nmemp2d)
    valid_vals <- vals[!is.na(vals)]
    if(length(valid_vals) == 0) NA else sample(valid_vals, 1)},
    
    FTE_change = FTE2-FTE)
```